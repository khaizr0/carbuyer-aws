<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trang Ch·ªß</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="/Public/css/home.css">
    <link rel="stylesheet" href="/Public/css/header.css">
    <link rel="stylesheet" href="/Public/css/footer.css">
    <link rel="icon" type="image/x-icon" href="/Public/images/CarLogo.png">
    
    <!-- External Libraries -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" 
          integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" 
          crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Configuration and Scripts -->
    <script src="/config/config.js"></script>
    <script src="/Public/JS/header.js" defer></script>
</head>
<body>
    <!-- Slideshow container -->
    <div class="slideshow-container" id="slideshow-container"></div>
    <div style="text-align:center" id="slideshow-dots"></div>
    <script>
        fetch('/slider')
            .then(response => response.json())
            .then(sliders => {
                const container = document.getElementById('slideshow-container');
                const dots = document.getElementById('slideshow-dots');
                container.innerHTML = sliders.map((s, i) => `
                    <div class="mySlides fade">
                        <img src="${s.hinhAnh}" style="width: 100%;" alt="${s.tieuDe || 'Slide ' + (i+1)}">
                    </div>
                `).join('') + '<a class="prev" onclick="plusSlides(-1)">&#10094;</a><a class="next" onclick="plusSlides(1)">&#10095;</a>';
                dots.innerHTML = sliders.map((s, i) => `<span class="dot" onclick="currentSlide(${i+1})"></span>`).join('');
                
                const script = document.createElement('script');
                script.src = '/Public/JS/slideshow.js';
                document.body.appendChild(script);
            })
            .catch(error => console.error('Error loading sliders:', error));
    </script>

    <!-- Recent Product Container -->
    <div class="product-recent-container">
        <h1>Xe m·ªõi v·ªÅ</h1>
        <div class="grid" id="recent-products-grid">
            <!-- Products will be dynamically inserted here -->
        </div>
        <br>
        <a href="/xedangban" class="button">Xem th√™m s·∫£n ph·∫©m</a>
    </div>

    <!-- Why Us Container -->
    <div class="why-choose-us-container">
        <div class="image-placeholder">
            <img src="/Public/images/CarLogo.png" alt="Company Logo">
        </div>
        <div class="content">
            <h2>V√¨ sao ch·ªçn ch√∫ng t√¥i?</h2>
            <p>
                L√† ƒë∆°n v·ªã chuy√™n ho·∫°t ƒë·ªông trong lƒ©nh v·ª±c kinh doanh c√°c lo·∫°i xe, ƒë·∫∑c bi·ªát l√† xe √ît√¥ Si√™u L∆∞·ªõt.
                V·ªõi ti√™u ch√≠ t·∫≠p trung v√†o nh·ªØng xe c√≥ s·ªë ODO (Km) th·∫•p, √≠t nƒÉm s·ª≠ d·ª•ng, c√≤n b·∫£o h√†nh ch√≠nh h√£ng v√† gi√° c·∫£ t·ªëi ∆∞u nh·∫•t.
                T·∫•t c·∫£ c√°c xe b√°n ra ƒë·ªÅu ƒë∆∞·ª£c tr·∫£i qua quy tr√¨nh ki·ªÉm tra nghi√™m ng·∫∑t ƒë·ªÉ ƒë·∫£m b·∫£o ti√™u chu·∫©n ch·∫•t l∆∞·ª£ng c≈©ng nh∆∞ ƒë·ªô an to√†n cho kh√°ch h√†ng.
                Ngo√†i ra, c√¥ng ty s·∫Ω k√Ω vƒÉn b·∫£n cam k·∫øt ƒë·ªÉ b·∫£o ƒë·∫£m s·ª± minh b·∫°ch, trung th·ª±c v·ªõi kh√°ch h√†ng.
            </p>
        </div>
    </div>

    <!-- Reviews Container -->
    <div class="reviews-container">
        <div class="reviews-header">
            <h2>ƒê√°nh gi√° c·ªßa kh√°ch h√†ng</h2>
        </div>
        <div class="slider-wrapper">
            <div class="slider" id="slider">
                <!-- Reviews will be dynamically loaded from DynamoDB -->
            </div>
            <div class="buttons">
                <button class="button" id="prevBtn"><i class="fas fa-angle-left"></i></button>
                <button class="button" id="nextBtn"><i class="fas fa-angle-right"></i></button>
            </div>
        </div>
    </div>
    <script>
        fetch('/review')
            .then(response => response.json())
            .then(reviews => {
                const slider = document.getElementById('slider');
                if (reviews.length === 0) {
                    slider.innerHTML = '<div style="text-align: center; padding: 40px; color: #888; width: 100%;"><h3>Hi·ªán t·∫°i ch∆∞a c√≥ ƒë√°nh gi√° n√†o</h3></div>';
                } else {
                    slider.innerHTML = reviews.map(r => `
                        <div class="review">
                            <img src="${r.hinhAnh ? '/Public/images/Database/danhgia/' + r.hinhAnh : '/Public/images/no-image-found.jpg'}" alt="${r.tenKH}" onerror="this.src='/Public/images/no-image-found.jpg'">
                            <h3>${r.tenKH}</h3>
                            <p>"${r.noiDung}"</p>
                        </div>
                    `).join('');
                }
            })
            .catch(error => console.error('Error loading reviews:', error));
    </script>
    <script src="/Public/JS/reviewSlider.js"></script>

    <!-- News Container -->
    <div class="news-container">
        <div class="news-header">
            <h2>Tin t·ª©c</h2>
        </div>
        <div class="news-grid" id="news-grid">
            <!-- News items will be dynamically inserted here -->
        </div>
        <p id="no-news" style="text-align: center; color: #888;">Hi·ªán t·∫°i ch∆∞a c√≥ tin t·ª©c n√†o.</p>
    </div>

    <!-- Google Maps Container -->
    <div class="map-container">
        <iframe id="mapFrame" allowfullscreen="" loading="lazy"></iframe>
    </div>
    <script>
        document.getElementById('mapFrame').src = mapConfig.url;
    </script>

    <!-- Footer -->
    <div id="footer-container"></div>
    <script src="/Public/JS/footer.js"></script>

    <!-- Product Fetching Script -->
    <script>
        fetch('/product/recent-products')
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(products => {
                console.log('Received products:', products);
                const gridContainer = document.getElementById('recent-products-grid');
                
                gridContainer.innerHTML = '';
                
                if (products.length === 0) {
                    gridContainer.innerHTML = '<div style="text-align: center; padding: 40px; color: #888; width: 100%;"><h3>Hi·ªán t·∫°i ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</h3></div>';
                } else {
                    products.forEach(product => {
                        const productCard = `
                            <div class="card" onclick="window.location.href='/chitietsanpham?id=${product.id}'">
                                <img 
                                    src="${product.imageUrl || '/Public/images/no-image-found.jpg'}" 
                                    alt="Car" 
                                    onerror="this.src='/Public/images/no-image-found.jpg'"
                                >
                                <div class="card-content">
                                    <p class="card-title">${product.name}</p>
                                    <p class="card-price">${product.price}</p>
                                    <p class="card-details">
                                        üìÖ ${product.year} / üöó ${product.mileage} / ‚õΩ ${product.fuelType}
                                    </p>
                                </div>
                            </div>
                        `;
                        gridContainer.innerHTML += productCard;
                    });
                }
            })
            .catch(error => console.error('Error fetching products:', error));
    </script>
    <script>
        // Fetch news data dynamically
        fetch('/news/api/showNewsOnHome')
            .then(response => response.json())
            .then(newsItems => {
                const newsGrid = document.getElementById('news-grid');
                const noNewsMessage = document.getElementById('no-news');
                
                if (newsItems.length > 0) {
                    noNewsMessage.style.display = 'none';
                    newsItems.forEach(news => {
                        const newsItem = `
                            <div class="news-item" onclick="window.location.href='/news/detail/${news.id}'">
                                <img src="${news.anhDaiDien ? `/Public/images/Database/tintuc/${news.anhDaiDien}` : '/Public/images/no-image-found.jpg'}" alt="${news.tenTT}" onerror="this.src='/Public/images/no-image-found.jpg'">
                                <div class="news-content">
                                    <h3>${news.tenTT}</h3>
                                    <p>${news.chiTietBaiViet.replace(/<[^>]*>/g, '').substring(0, 100)}...</p>
                                    <div class="news-footer">
                                        <p><strong>Ng√†y ƒëƒÉng:</strong> ${new Date(news.ngayDang).toLocaleDateString('vi-VN')}</p>
                                    </div>
                                </div>
                            </div>
                        `;
                        newsGrid.innerHTML += newsItem;
                    });
                }
            })
            .catch(error => {
                console.error('Error fetching news:', error);
            });
    </script>
</body>
</html>